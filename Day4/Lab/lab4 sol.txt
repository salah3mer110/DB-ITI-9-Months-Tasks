use Company_SD


--1.	Display (Using Union Function)
--a.	 The name and the gender of the dependence that's gender is Female and depending on Female Employee.
select Dependent_name, d.Sex
from employee e join dependent d
on ssn=essn
where d.sex='F' and e.sex='F'

--b.	 And the male dependence that depends on Male Employee.
select Dependent_name, d.Sex
from employee e join dependent d
on ssn=essn
where d.sex='F' and e.sex='F'

--union
select Dependent_name, d.Sex
from employee e join dependent d
on ssn=essn
where d.sex='F' and e.sex='F'
union 
select Dependent_name, d.Sex
from employee e join dependent d
on ssn=essn
where d.sex='M' and e.sex='M'

--2.	For each project, list the project name and the total hours per week (for all employees) spent on that project.
select pname,sum(hours) "Total hours"
from project join works_for
on pnumber=pno
group by pname


--3.	Display the data of the department which has the smallest employee ID over all employees' ID.
select d.*
from departments d join employee e
on dnum=dno
where ssn in (select min(ssn) from employee)

--4.	For each department, retrieve the department name and the maximum, minimum and average salary of its employees.
select dname,max(salary) "max salary",min(salary) "min salary",avg(salary) "avg salary"
from employee join departments
on dnum=dno
group by dname


--5.	List the full name of all managers who have no dependents.
select fname +' '+lname "Fullname"
from employee join departments
on ssn=mgrssn
except
select fname +' '+lname "Fullname"
from employee join dependent
on ssn=essn



--6.	For each department-- if its average salary is less than the average salary of all employees-- display its number, name and number of its employees.
select dname ,Dnum,count(ssn) "Emp no."
from employee join Departments
on Dnum=dno
group by dname,dnum
having avg(Salary) < (select avg(Salary) from employee)



--7.	Retrieve a list of employees names and the projects names they are working on ordered by department number and within each department,
--ordered alphabetically by last name, first name.
select fname, lname , pname
from employee join Works_for 
on ssn=essn
join project 
on Pnumber=Pno
order by Dnum, fname,lname

--8.	Try to get the max 2 salaries using subquery
select max(salary) "max salary",(select max(salary)
from employee where Salary not in (select max(salary)
from employee)) "second max salary"
from employee


--9.	Get the full name of employees that is similar to any dependent name
select fname +' '+lname "fullname"
from employee 
intersect 
select Dependent_name
from Dependent


--10.	Display the employee number and name if at least one of them have dependents (use exists keyword) self-study.
select ssn , fname
from employee
where exists (select Dependent_name from Dependent join employee
on ssn=essn)



--11.	In the department table insert new department called "DEPT IT" , with id 100, employee with SSN = 112233 as a manager for this department. The start date for this manager is '1-11-2006'
insert into departments values('DEPT IT',100,112233,1-11-2006)



--12.	Do what is required if you know that : Mrs.Noha Mohamed(SSN=968574)  moved to be the manager of the new department (id = 100), and they give you(your SSN =102672) her position (Dept. 20 manager) 
--a.	First try to update her record in the department table
update Departments
set MGRSSN = 968574
where Dnum = 100


--b.	Update your record to be department 20 manager.
update Departments
set MGRSSN = 102672
where Dnum = 20


--c.	Update the data of employee number=102660 to be in your teamwork (he will be supervised by you) (your SSN =102672)
update employee
set Superssn = 102672
where SSN=102660


--13.	Unfortunately the company ended the contract with Mr. Kamel Mohamed (SSN=223344) so try to delete his data from your database in case you know that you will be temporarily in his position.
--Hint: (Check if Mr. Kamel has dependents, works as a department manager, supervises any employees or works in any projects and handle these cases).
select  e.* 
from Dependent join employee e
on ssn=essn
join Departments d
on ssn=MGRSSN
join project p
on p.Dnum=d.dnum
where ssn=223344


delete from Dependent
where ESSN = 223344


delete from Works_for
where ESSN = 223344

update Departments
set MGRSSN=NULL
where MGRSSN=223344

update employee
set Superssn=NULL
where Superssn=223344

delete from employee
where SSN = 223344


select *
from employee
where ssn =223344



--14.	Try to update all salaries of employees who work in Project ‘Al Rabwah’ by 30%
update employee 
set Salary = Salary + Salary *30/100
from employee join works_for
on ssn =essn
join project
on pnumber =pno
where Pname = 'Al Rabwah'

